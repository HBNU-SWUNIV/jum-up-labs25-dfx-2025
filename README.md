# 국립한밭대학교 컴퓨터공학과 DfX팀

**팀 구성**
- 30251270 유태원
- 30251268 송찬호
- 20202066 안다은
- 20201737 백민우
- 20222278 박동현

## Project Background
- 깻잎은 연중 재배되는 대표적인 엽채류로, 현재까지 수확 공정이 숙련 인력의 수작업에 의존하고 있습니다.
이로 인해 노동 강도, 생산성 저하, 품질 편차 등의 문제가 발생하고 있습니다.

본 프로젝트는 광센서 기반의 줄기 탐지 기술과 와이어 구동 절단 메커니즘을 결합한 엔드이펙터를 설계하여
잎 손상 없는 자동 수확 시스템을 구현하는 것을 목표로 합니다.

## System Model

### 전체 구조 개요
본 시스템은 비전 인식부, 로봇 제어부, 엔드이펙터 구동부의 세 가지 핵심 모듈로 구성됩니다.
RGB-D 카메라로 획득한 데이터를 기반으로 YOLOv11-OBB 모델이 깻잎의 위치와 자세를 인식하고,
Jetson Orin Nano에서 연산 후 Neuromeka Indy7 로봇팔과 OpenCR 제어기로 명령을 전달합니다.

### 작동 절차
깻잎 자동 수확 시스템의 전체 동작 절차는 5단계로 구성되어 있습니다
1. 목표 잎 탐지
  - YOLOv11-OBB로 인식된 깻잎의 3D 좌표를 계산 후 좌하단→우상단 순서로 수확 경로를 설정
2. 측면 진입
  - 생장점을 보호하기 위해 잎보다 약 6cm 낮은 위치에서 접근
3. 줄기 탐지 및 파지
  - 포토센서 감지 신호에 따라 줄기를 안정적으로 파지
4. 잎자루 감지 및 절단 준비
  - 마이크로 포토센서가 잎자루 통과를 감지하면 절단 명령 대기
5. 절단 및 수확
  - 와이어 메커니즘이 작동해 절단과 파지를 동시에 수행

### 객체 매칭 및 자세 추정

<img width="224" height="168" alt="image" src="https://github.com/user-attachments/assets/becceb42-eb3f-4744-96ec-2365391aef23" />

- 중심 잎의 양쪽 **긴 변(mid-edge)** 중점을 기준으로 주변 수확용 잎의 경계 상자(OBB)까지의 거리를 계산.  
- 각 중점에서 가장 가까운 수확 잎을 선택하여 **1개의 중심 잎 ↔ 최대 2개의 수확 잎** 관계를 형성.  
- 중복 매칭 발생 시 더 짧은 거리의 매칭만 유지하여 **정확한 leaf entity 구성**을 보장.

<img width="200" height="171" alt="image" src="https://github.com/user-attachments/assets/f4d58d30-62b4-4ee0-9ba4-3cdae520ce72" />

- 매칭된 수확 잎 쌍의 OBB에서 **가장 가까운 변의 중점(midpoint)** 을 계산하고,  
  두 점을 잇는 선분의 **중심(center)** 을 줄기 위치로,  
  선분의 **기울기(angle)** 을 잎의 방향(orientation)으로 정의.  
- 이 정보를 로봇 제어부에서 활용하여 **엔드이펙터의 진입 위치 및 각도 보정**을 수행.  

### 4 좌표 변환 및 로봇 접근

RGB-D 카메라에서 얻은 픽셀 좌표를 실제 공간상의 3차원 좌표로 변환하여  
로봇팔이 깻잎의 줄기 위치와 방향에 정밀하게 접근하도록 제어하였다.  
깊이 정보와 카메라 내부 파라미터를 이용해 좌표를 환산하고,  
카메라–로봇 간 오프셋과 회전각을 보정해 엔드이펙터의 진입 위치를 계산하였다.  

<img width="265" height="255" alt="image" src="https://github.com/user-attachments/assets/1a44b5b8-aa97-4e32-8b67-eb2fbd425445" />


## Numerical Results
### 1) YOLOv11-OBB
| Metric | Precision | Recall | mAP@0.5 | mAP@0.5:0.95 |
|:------:|:--------:|:-----:|:-------:|:------------:|
| Result | 0.977    | 0.983 | 0.994   | 0.864        |

**Table 2. Experimental results of the perilla harvesting process**

|           | Step 1 | Step 2 | Step 3 | Result |
|-----------|:------:|:------:|:------:|:-----:|
| Trials    |   50   |   50   |   46   |  50   |
| Successes |   50   |   46   |   41   |  41   |
| Performance | 100% |  92%   |  89%   |  82%  |

## Conclusion
- ABCD

## Project Outcome
- ABCD
